<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Introcomp Exams</title>
  {{ script('icons/feather.min') }}
  {{ script('scripts/moment.min') }}
  {{ style('styles/student/waiting') }}
</head>
<body>
  <div class="circle"></div>
  <div class="introcomp-logo"></div>
  <div class="title" id="title">Aguarde, sua prova já vai começar</div>
  <a class="timer" href="javascript:void(0)" onClick="toggleTimer()">
    <i data-feather="clock" class='clock-icon'></i>
    <span class="text" id="countdown"></span>
  </a>
  <a href="javascript:void(0)" class="begin-button-container button-begin" onClick="startExam()">
    <span style="margin-bottom: 2px;"> iniciar</span>
    <i data-feather="chevron-right" class='chevron-icon'></i>
  </a>


  @component('components.rules')
  @endcomponent

</body>
</html>

<script>
  let toggle = true;
  var clock = document.getElementById("countdown") 
  var title = document.getElementById("title") 
  const start = moment({{{ toJSON(schedule.start_datetime) }}})
  const resisterString = {{{ toJSON(schedule.register_time) }}}
  const registerTime = resisterString.split(':')
  start.add(registerTime[0], 'h')
  start.add(registerTime[1], 'm')
  start.add(registerTime[2], 's')

  const time = moment.duration(start.diff(moment()))
  clock.innerHTML = time.hours().toString().padStart(2, '0') + ":" + time.minutes().toString().padStart(2, '0')
  if (time.milliseconds() < 0) {
     clock.innerHTML = "00:00"
     title.innerHTML = "Você já pode começar sua prova"
  }
  setInterval(() => {
    const time = moment.duration(start.diff(moment()))
    if (time.milliseconds() < 0) {
      clock.innerHTML = "00:00"
      title.innerHTML = "Você já pode começar sua prova"
    } else {
      if (toggle) {
        clock.innerHTML = time.hours().toString().padStart(2, '0') + ":" + time.minutes().toString().padStart(2, '0')
      }
    }

  }, 1000)

  feather.replace()

  function toggleTimer() {
    toggle = !toggle;
    if (!toggle) {
      clock.innerHTML = "TEMPO"
    } else {
      const time = moment.duration(start.diff(moment()))

      clock.innerHTML = time.hours().toString().padStart(2, '0') + ":" + time.minutes().toString().padStart(2, '0')
    }
  }

  function startExam() {
    const time = moment.duration(start.diff(moment()))
    if (time.milliseconds() < 0) {
      window.location.replace({{{ toJSON(route('exam.show')) }}})
    }
  }
</script>